---
import Image from "@/components/ui/image.astro";
import PageTitle from "@/components/ui/page-title.astro";
import SectionContainer from "@/components/ui/section-container.astro";
import Tag from "@/components/ui/tag.astro";

interface Author {
  name: string;
  avatar?: string;
  authorBioLink: string;
}

interface Post {
  filePath: string;
  path: string;
  slug: string;
  date: string;
  title: string;
  tags?: string[];
}

interface Props {
  content: Post;
  authorDetails: Author[];
  next?: { path: string; title: string };
  prev?: { path: string; title: string };
  children: any;
}

const { content, authorDetails, next, prev } = Astro.props;
const { filePath, path, date, title, tags } = content;
const basePath = path.split("/")[0];

// Format date function
function formatDate(date: string, locale: string = "en-US") {
  return new Date(date).toLocaleDateString(locale, {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

const editUrl = (path: string) =>
  `https://github.com/hmzelidrissi/hmzelidrissi.ma/blob/main/src/content/blog/${path}`;
---

<SectionContainer>
  <article>
    <div class="xl:divide-y xl:divide-border">
      <header>
        <div class="space-y-4 border-b border-border pb-10 pt-10 text-center">
          <dl>
            <div>
              <dt class="sr-only">Published on</dt>
              <dd class="text-sm font-mono uppercase tracking-tight text-muted-foreground">
                <time datetime={date}>{formatDate(date)}</time>
              </dd>
            </div>
          </dl>
          <div>
            <PageTitle>{title}</PageTitle>
          </div>
        </div>
      </header>
      <div
        class="grid-rows-[auto_1fr] divide-y divide-border pb-8 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"
      >
        <dl class="pb-10 pt-6 xl:border-b xl:border-border xl:pt-11">
          <dt class="sr-only">Authors</dt>
          <dd>
            <ul
              class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"
            >
              {
                authorDetails.map((author) => (
                  <li class="flex items-center space-x-2">
                    {author.avatar && (
                      <Image
                        src={author.avatar}
                        width={38}
                        height={38}
                        alt="avatar"
                        className="h-10 w-10 rounded-full"
                      />
                    )}
                    <dl class="whitespace-nowrap font-mono text-sm leading-5">
                      <dt class="sr-only">Name</dt>
                      <dd class="text-muted-foreground">
                        <span class="mr-1">by</span>
                        <a
                          href={`/${author.authorBioLink}`}
                          class="font-medium text-foreground transition-colors hover:text-muted-foreground underline decoration-border underline-offset-4 hover:decoration-foreground"
                        >
                          {author.name}
                        </a>
                      </dd>
                    </dl>
                  </li>
                ))
              }
            </ul>
          </dd>
        </dl>
        <div class="divide-y divide-border xl:col-span-3 xl:row-span-2 xl:pb-0">
          <div class="prose max-w-none pb-8 pt-10 dark:prose-invert">
            <slot />
          </div>
          <div class="pb-6 pt-6 text-sm">
            <a
              href={editUrl(filePath)}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1 font-mono text-sm text-muted-foreground transition-colors hover:text-foreground"
            >
              View on GitHub
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-3 w-3"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"
                ></path>
                <path
                  d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"
                ></path>
              </svg>
            </a>
          </div>
        </div>
        <footer>
          <div class="pt-4 xl:pt-8">
            <a
              href={`/${basePath}`}
              class="inline-flex items-center gap-2 font-mono text-sm text-muted-foreground transition-colors hover:text-foreground"
              aria-label="Back to the blog"
            >
              <span class="font-mono text-muted-foreground">&larr;</span>
              Back to the blog
            </a>
          </div>
          <div
            class="divide-border text-sm font-medium leading-5 xl:col-start-1 xl:row-start-2 xl:divide-y"
          >
            {
              tags && (
                <div class="py-4 xl:py-8">
                  <h2 class="mb-2 font-mono text-xs uppercase tracking-tight text-muted-foreground">
                    Tags
                  </h2>
                  <div class="mt-2 flex flex-wrap gap-2">
                    {tags.map((tag) => (
                      <Tag text={tag} />
                    ))}
                  </div>
                </div>
              )
            }
            {
              (next || prev) && (
                <div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8">
                  {prev && prev.path && (
                    <div class="group relative">
                      <h2 class="mb-1 font-mono text-xs uppercase tracking-tight text-muted-foreground">
                        Previous Article
                      </h2>
                      <a
                        href={`/${prev.path}`}
                        class="block font-medium text-foreground transition-colors group-hover:text-muted-foreground underline decoration-border underline-offset-4 hover:decoration-muted-foreground"
                      >
                        &larr; {prev.title}
                      </a>
                    </div>
                  )}
                  {next && next.path && (
                    <div class="group relative">
                      <h2 class="mb-1 font-mono text-xs uppercase tracking-tight text-muted-foreground">
                        Next Article
                      </h2>
                      <a
                        href={`/${next.path}`}
                        class="block font-medium text-foreground transition-colors group-hover:text-muted-foreground underline decoration-border underline-offset-4 hover:decoration-muted-foreground"
                      >
                        {next.title} &rarr;
                      </a>
                    </div>
                  )}
                </div>
              )
            }
          </div>
        </footer>
      </div>
    </div>
  </article>
</SectionContainer>

---
import Image from "@/components/ui/image.astro";
import PageTitle from "@/components/ui/page-title.astro";
import SectionContainer from "@/components/ui/section-container.astro";
import Tag from "@/components/ui/tag.astro";

interface Author {
  name: string;
  avatar?: string;
  authorBioLink: string;
}

interface Post {
  filePath: string;
  path: string;
  slug: string;
  date: string;
  title: string;
  tags?: string[];
}

interface Props {
  content: Post;
  authorDetails: Author[];
  next?: { path: string; title: string };
  prev?: { path: string; title: string };
  children: any;
}

const { content, authorDetails, next, prev } = Astro.props;
const { filePath, path, date, title, tags } = content;
const basePath = path.split("/")[0];

// Format date function
function formatDate(date: string, locale: string = "en-US") {
  return new Date(date).toLocaleDateString(locale, {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

const editUrl = (path: string) =>
  `https://github.com/hmzelidrissi/hmzelidrissi.ma/blob/main/src/content/blog/${path}`;
---

<SectionContainer>
  <article>
    <div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700">
      <header>
        <div
          class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"
        >
          <dl>
            <div class="flex items-center justify-center space-x-2">
              <dt class="sr-only">Published on</dt>
              <dd
                class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"
              >
                <time datetime={date}>{formatDate(date)}</time>
              </dd>
            </div>
          </dl>
          <div>
            <PageTitle>{title}</PageTitle>
          </div>
        </div>
      </header>
      <div
        class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"
      >
        <dl
          class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"
        >
          <dt class="sr-only">Authors</dt>
          <dd>
            <ul
              class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"
            >
              {
                authorDetails.map((author) => (
                  <li class="flex items-center space-x-2">
                    {author.avatar && (
                      <Image
                        src={author.avatar}
                        width={38}
                        height={38}
                        alt="avatar"
                        className="h-10 w-10 rounded-full"
                      />
                    )}
                    <dl class="whitespace-nowrap text-sm font-medium leading-5">
                      <dt class="sr-only">Name</dt>
                      <dd class="text-gray-900 dark:text-gray-100">
                        by{" "}
                        <a
                          href={`/${author.authorBioLink}`}
                          class="text-primary-500 hover:text-primary-600 dark:text-teal-400 dark:hover:text-teal-500"
                        >
                          {author.name}
                        </a>
                      </dd>
                    </dl>
                  </li>
                ))
              }
            </ul>
          </dd>
        </dl>
        <div
          class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"
        >
          <div class="prose max-w-none pb-8 pt-10 dark:prose-invert">
            <slot />
          </div>
          <div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300">
            <a
              href={editUrl(filePath)}
              target="_blank"
              rel="noopener noreferrer">View on GitHub</a
            >
          </div>
        </div>
        <footer>
          <div
            class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"
          >
            {
              tags && (
                <div class="py-4 xl:py-8">
                  <h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                    Tags
                  </h2>
                  <div class="flex flex-wrap">
                    {tags.map((tag) => (
                      <Tag text={tag} className="mb-0.5" />
                    ))}
                  </div>
                </div>
              )
            }
            {
              (next || prev) && (
                <div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8">
                  {prev && prev.path && (
                    <div>
                      <h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                        Previous Article
                      </h2>
                      <div class="text-primary-500 hover:text-primary-600 dark:text-teal-400 dark:hover:text-teal-500">
                        <a href={`/${prev.path}`}>{prev.title}</a>
                      </div>
                    </div>
                  )}
                  {next && next.path && (
                    <div>
                      <h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                        Next Article
                      </h2>
                      <div class="text-primary-500 hover:text-primary-600 dark:text-teal-400 dark:hover:text-teal-500">
                        <a href={`/${next.path}`}>{next.title}</a>
                      </div>
                    </div>
                  )}
                </div>
              )
            }
          </div>
          <div class="pt-4 xl:pt-8">
            <a
              href={`/${basePath}`}
              class="text-primary-500 hover:text-primary-600 hover:underline dark:text-teal-400 dark:hover:text-teal-500"
              aria-label="Back to the blog"
            >
              &larr; Back to the blog
            </a>
          </div>
        </footer>
      </div>
    </div>
  </article>
</SectionContainer>

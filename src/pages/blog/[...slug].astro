---
import RootLayout from "@/layouts/RootLayout.astro";
import PostLayout from "@/layouts/PostLayout.astro";
import { getCollection } from "astro:content";
import { getPostSlug, isPostPublished } from "@/lib/utils";

export async function getStaticPaths() {
  const posts = await getCollection("blog", isPostPublished);

  return posts.map((post) => ({
    params: { slug: getPostSlug(post) },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get author details (you can customize this based on your needs)
const authorDetails = [
  {
    name: "Hamza El Idrissi",
    avatar: "/stylish-owl.png", // Use a default avatar image
    authorBioLink: "whoami",
  },
];

// Transform post data to match the expected interface
const transformedPost = {
  filePath: post.id,
  path: `blog/${getPostSlug(post)}`,
  slug: getPostSlug(post),
  date: post.data.date,
  title: post.data.title,
  tags: post.data.tags || [],
  ig: false,
  bsky: false,
  threads: false,
  x: true,
  fb: false,
  reddit: false,
  pinterest: false,
};
---

<RootLayout title={`${post.data.title} - Blog`}>
  <PostLayout content={transformedPost} authorDetails={authorDetails}>
    <Content />
  </PostLayout>
</RootLayout>

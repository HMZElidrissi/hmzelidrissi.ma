---
import RootLayout from "@/layouts/RootLayout.astro";
import AuthorLayout from "@/layouts/AuthorLayout.astro";
import { getCollection } from "astro:content";
import SEO from "@/components/seo/index.astro";
import Schema from "@/components/structured-data/index.astro";

// Load author from content collection (matches Next.js behavior of using default author)
const authors = await getCollection("authors");
if (authors.length === 0) {
  throw new Error("No authors found in the 'authors' content collection.");
}
// Prefer the default schema name; fallback to first author
const author = (authors.find((a) => a.data.name === "Hamza El Idrissi") ??
  authors[0])!;
const { Content } = await author.render();

// Map to AuthorLayout props and normalize avatar
const data: any = author.data;
const avatarValue = data.avatar;
const avatar =
  avatarValue && typeof avatarValue === "object" && "src" in avatarValue
    ? avatarValue.src
    : avatarValue;

const authorForLayout = {
  name: data.name,
  avatar,
  occupation: data.occupation,
  updatedAt: data.updatedAt,
};
---

<RootLayout>
  <SEO
    slot="seo"
    title="Who am I?"
    description="a developer who aims to evolve, innovate, and inspire through technology."
  />
  <Schema slot="ld+json" type="Person" />
  <AuthorLayout content={authorForLayout}>
    <Content />
  </AuthorLayout>
</RootLayout>
